<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°åŠ è½½</title>
    <style>
        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            text-align: center;
        }
        .container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .button {
            background: white;
            color: #667eea;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            font-weight: bold;
        }
        .button:hover {
            background: #f0f0f0;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ æ¸…é™¤ç¼“å­˜å·¥å…·</h1>
        <p>æ­¤é¡µé¢å°†å¸®åŠ©æ‚¨æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶é‡æ–°åŠ è½½æ­£ç¡®çš„æ–‡ä»¶</p>

        <div class="status" id="status">
            <h3>æ£€æµ‹åˆ°çš„é—®é¢˜ï¼š</h3>
            <p>æµè§ˆå™¨ç¼“å­˜äº†æ—§ç‰ˆæœ¬çš„ JavaScript æ–‡ä»¶</p>
            <p>LaTeX å…¬å¼æ–‡ä»¶å·²ä¿®å¤ï¼Œä½†æµè§ˆå™¨æ˜¾ç¤ºçš„æ˜¯ç¼“å­˜ç‰ˆæœ¬</p>
        </div>

        <button class="button" onclick="clearAllCache()">æ¸…é™¤æ‰€æœ‰ç¼“å­˜</button>
        <button class="button" onclick="reloadWithoutCache()">å¼ºåˆ¶é‡æ–°åŠ è½½</button>
        <button class="button" onclick="openFreshIndex()">æ‰“å¼€å…¨æ–° Index</button>

        <div id="result"></div>
    </div>

    <script>
        // æ¸…é™¤æ‰€æœ‰å¯èƒ½çš„ç¼“å­˜
        async function clearAllCache() {
            const result = document.getElementById('result');
            result.innerHTML = '<div class="status"><p>æ­£åœ¨æ¸…é™¤ç¼“å­˜...</p></div>';

            try {
                // æ¸…é™¤ Service Worker ç¼“å­˜
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    await Promise.all(
                        cacheNames.map(name => caches.delete(name))
                    );
                    console.log('âœ… Service Worker ç¼“å­˜å·²æ¸…é™¤');
                }

                // æ³¨é”€æ‰€æœ‰ Service Workers
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    await Promise.all(
                        registrations.map(reg => reg.unregister())
                    );
                    console.log('âœ… Service Workers å·²æ³¨é”€');
                }

                // æ¸…é™¤ localStorage
                localStorage.clear();
                console.log('âœ… localStorage å·²æ¸…é™¤');

                // æ¸…é™¤ sessionStorage
                sessionStorage.clear();
                console.log('âœ… sessionStorage å·²æ¸…é™¤');

                result.innerHTML = `
                    <div class="success">
                        <h3>âœ… ç¼“å­˜æ¸…é™¤æˆåŠŸï¼</h3>
                        <p>å·²æ¸…é™¤ï¼š</p>
                        <ul style="text-align: left; display: inline-block;">
                            <li>Service Worker ç¼“å­˜</li>
                            <li>æ‰€æœ‰æ³¨å†Œçš„ Service Workers</li>
                            <li>LocalStorage</li>
                            <li>SessionStorage</li>
                        </ul>
                        <p><strong>ç°åœ¨è¯·ç‚¹å‡»"æ‰“å¼€å…¨æ–° Index"æŒ‰é’®</strong></p>
                    </div>
                `;
            } catch (error) {
                result.innerHTML = `<div class="status"><p>âŒ æ¸…é™¤ç¼“å­˜æ—¶å‡ºé”™: ${error.message}</p></div>`;
            }
        }

        // å¼ºåˆ¶é‡æ–°åŠ è½½ï¼ˆç»•è¿‡ç¼“å­˜ï¼‰
        function reloadWithoutCache() {
            // æ·»åŠ éšæœºå‚æ•°é˜²æ­¢ç¼“å­˜
            const timestamp = new Date().getTime();
            window.location.href = `index.html?nocache=${timestamp}`;
        }

        // æ‰“å¼€å¸¦æ—¶é—´æˆ³çš„æ–°ç‰ˆæœ¬
        function openFreshIndex() {
            const timestamp = new Date().getTime();
            // åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€ï¼Œå¸¦ç¼“å­˜ç ´åå‚æ•°
            window.open(`index.html?v=${timestamp}&refresh=true`, '_blank');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æµ‹
        window.addEventListener('load', function() {
            console.log('=== ç¼“å­˜æ¸…é™¤å·¥å…·å·²åŠ è½½ ===');
            console.log('å»ºè®®æ“ä½œé¡ºåºï¼š');
            console.log('1. ç‚¹å‡»"æ¸…é™¤æ‰€æœ‰ç¼“å­˜"');
            console.log('2. ç­‰å¾…æˆåŠŸæç¤º');
            console.log('3. ç‚¹å‡»"æ‰“å¼€å…¨æ–° Index"');
            console.log('4. æ£€æŸ¥å…¬å¼æ˜¯å¦æ­£ç¡®æ˜¾ç¤º');
        });
    </script>
</body>
</html>
