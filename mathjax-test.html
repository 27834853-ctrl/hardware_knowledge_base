<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathJax æ¸²æŸ“æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 30px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        h2 {
            color: #555;
            margin-top: 30px;
        }
        .formula {
            background: #f9f9f9;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #4CAF50;
            font-size: 18px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #45a049;
        }
        #dynamicContent {
            min-height: 100px;
            border: 2px dashed #ccc;
            padding: 20px;
            margin: 20px 0;
        }
    </style>

    <!-- MathJax é…ç½®ï¼ˆä¸ index.html ç›¸åŒï¼‰-->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            },
            startup: {
                pageReady: () => {
                    return MathJax.startup.defaultPageReady().then(() => {
                        console.log('âœ… MathJax åˆå§‹åŒ–å®Œæˆ');
                        document.getElementById('mathjaxStatus').className = 'status success';
                        document.getElementById('mathjaxStatus').textContent = 'âœ… MathJax å·²æˆåŠŸåŠ è½½';
                        window.dispatchEvent(new Event('mathjax-ready'));
                    });
                }
            }
        };

        // å…¨å±€ MathJax é‡æ–°æ¸²æŸ“å‡½æ•°
        window.renderMathJax = function(element) {
            if (!window.MathJax || !window.MathJax.typesetPromise) {
                console.warn('âš ï¸ MathJax å°šæœªåŠ è½½å®Œæˆï¼Œç­‰å¾…åé‡è¯•...');
                setTimeout(() => window.renderMathJax(element), 100);
                return;
            }

            const target = element || document.body;
            console.log('ğŸ”„ å¼€å§‹æ¸²æŸ“ MathJax å…¬å¼...');

            return MathJax.typesetPromise([target])
                .then(() => {
                    console.log('âœ… MathJax å…¬å¼æ¸²æŸ“å®Œæˆ');
                    document.getElementById('renderStatus').className = 'status success';
                    document.getElementById('renderStatus').textContent = 'âœ… åŠ¨æ€å†…å®¹ MathJax æ¸²æŸ“æˆåŠŸ';
                })
                .catch((err) => {
                    console.error('âŒ MathJax æ¸²æŸ“å¤±è´¥:', err);
                    document.getElementById('renderStatus').className = 'status error';
                    document.getElementById('renderStatus').textContent = 'âŒ MathJax æ¸²æŸ“å¤±è´¥: ' + err.message;
                });
        };
    </script>
    <!-- MathJax for LaTeX -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <h1>ğŸ§ª MathJax æ¸²æŸ“æµ‹è¯•é¡µé¢</h1>

    <div id="mathjaxStatus" class="status info">â³ ç­‰å¾… MathJax åŠ è½½...</div>

    <!-- æµ‹è¯•åŒºåŸŸ 1ï¼šé™æ€å†…å®¹ -->
    <div class="test-section">
        <h2>ğŸ“ æµ‹è¯• 1ï¼šé¡µé¢åŠ è½½æ—¶çš„é™æ€å…¬å¼</h2>
        <p>è¿™äº›å…¬å¼åœ¨é¡µé¢åŠ è½½æ—¶å°±å­˜åœ¨ï¼Œåº”è¯¥è‡ªåŠ¨æ¸²æŸ“ï¼š</p>

        <div class="formula">
            <strong>é¢„åŠ é‡å…¬å¼ï¼š</strong><br>
            $De-emphasis (dB) = 20 \times \log_{10}\left(\frac{V_{low}}{V_{high}}\right)$
        </div>

        <div class="formula">
            <strong>é˜»æŠ—å…¬å¼ï¼š</strong><br>
            $Z_0 = \frac{87}{\sqrt{\varepsilon_r + 1.41}} \ln\left(\frac{5.98h}{0.8w + t}\right)$
        </div>

        <div class="formula">
            <strong>ä¼ è¾“çº¿å»¶è¿Ÿï¼š</strong><br>
            $$t_d = \sqrt{\varepsilon_{eff}} \times \frac{L}{c_0}$$
        </div>
    </div>

    <!-- æµ‹è¯•åŒºåŸŸ 2ï¼šåŠ¨æ€åŠ è½½å†…å®¹ -->
    <div class="test-section">
        <h2>ğŸš€ æµ‹è¯• 2ï¼šåŠ¨æ€åŠ è½½çš„å…¬å¼</h2>
        <p>ç‚¹å‡»æŒ‰é’®åŠ¨æ€åŠ è½½å†…å®¹ï¼ˆæ¨¡æ‹Ÿ showHighSpeedContent å‡½æ•°ï¼‰ï¼š</p>

        <button onclick="loadDynamicContent()">åŠ è½½åŠ¨æ€å†…å®¹</button>
        <button onclick="clearDynamicContent()">æ¸…ç©ºå†…å®¹</button>

        <div id="renderStatus" class="status info">â³ ç­‰å¾…åŠ è½½åŠ¨æ€å†…å®¹...</div>

        <div id="dynamicContent">
            <p style="color: #999;">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åŠ è½½å†…å®¹...</p>
        </div>
    </div>

    <!-- æµ‹è¯•åŒºåŸŸ 3ï¼šè¯Šæ–­ä¿¡æ¯ -->
    <div class="test-section">
        <h2>ğŸ” æµ‹è¯• 3ï¼šè¯Šæ–­ä¿¡æ¯</h2>
        <button onclick="runDiagnostics()">è¿è¡Œè¯Šæ–­</button>
        <pre id="diagnostics" style="background: #f5f5f5; padding: 15px; border-radius: 4px; overflow-x: auto;"></pre>
    </div>

    <script>
        // åŠ¨æ€åŠ è½½å†…å®¹å‡½æ•°ï¼ˆæ¨¡æ‹Ÿ showHighSpeedContentï¼‰
        function loadDynamicContent() {
            console.log('ğŸ”„ åŠ è½½åŠ¨æ€å†…å®¹...');

            const contentArea = document.getElementById('dynamicContent');

            // ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²ï¼ŒåŒ…å«åŒåæ–œæ ï¼ˆJavaScript å­—ç¬¦ä¸²è½¬ä¹‰ï¼‰
            const content = `
                <h3>PCIe å‘é€ç«¯æµ‹è¯•å…¬å¼</h3>

                <div class="formula">
                    <strong>å·®åˆ†è¾“å‡ºç”µå‹ï¼š</strong><br>
                    $V_{diff,pp} = |V_{TX+} - V_{TX-}|_{pp}$
                </div>

                <div class="formula">
                    <strong>De-emphasis è®¡ç®—ï¼š</strong><br>
                    $De-emphasis (dB) = 20 \\times \\log_{10}\\left(\\frac{V_{low}}{V_{high}}\\right)$
                </div>

                <div class="formula">
                    <strong>çœ¼é«˜è®¡ç®—ï¼š</strong><br>
                    $Eye\\ Height = V_{diff,pp} \\times (1 - \\frac{Jitter_{RMS}}{UI}) - Noise_{RMS}$
                </div>

                <div class="formula">
                    <strong>æŠ–åŠ¨é¢„ç®—ï¼š</strong><br>
                    $$TJ_{Total} = \\sqrt{DJ^2 + RJ^2}$$
                </div>

                <div class="formula">
                    <strong>æ’å…¥æŸè€—ï¼š</strong><br>
                    $IL(f) = 20 \\times \\log_{10}\\left(\\frac{V_{out}(f)}{V_{in}(f)}\\right)$
                </div>
            `;

            // æ›´æ–° DOM
            contentArea.innerHTML = content;

            // å»¶è¿Ÿæ¸²æŸ“ MathJaxï¼ˆç¡®ä¿ DOM æ›´æ–°å®Œæˆï¼‰
            setTimeout(() => {
                console.log('ğŸ”„ è§¦å‘ MathJax é‡æ–°æ¸²æŸ“...');
                if (window.renderMathJax) {
                    window.renderMathJax(contentArea);
                } else {
                    document.getElementById('renderStatus').className = 'status error';
                    document.getElementById('renderStatus').textContent = 'âŒ renderMathJax å‡½æ•°ä¸å­˜åœ¨';
                }
            }, 100);
        }

        // æ¸…ç©ºåŠ¨æ€å†…å®¹
        function clearDynamicContent() {
            document.getElementById('dynamicContent').innerHTML = '<p style="color: #999;">å†…å®¹å·²æ¸…ç©º</p>';
            document.getElementById('renderStatus').className = 'status info';
            document.getElementById('renderStatus').textContent = 'â³ ç­‰å¾…åŠ è½½åŠ¨æ€å†…å®¹...';
        }

        // è¿è¡Œè¯Šæ–­
        function runDiagnostics() {
            const diagnosticsDiv = document.getElementById('diagnostics');
            let output = '';

            output += '=== MathJax è¯Šæ–­ä¿¡æ¯ ===\n\n';

            // æ£€æŸ¥ MathJax å¯¹è±¡
            output += '1. MathJax å¯¹è±¡å­˜åœ¨: ' + (typeof MathJax !== 'undefined' ? 'âœ…' : 'âŒ') + '\n';

            if (typeof MathJax !== 'undefined') {
                output += '2. MathJax.version: ' + (MathJax.version || 'æœªçŸ¥') + '\n';
                output += '3. MathJax.typesetPromise å­˜åœ¨: ' + (typeof MathJax.typesetPromise === 'function' ? 'âœ…' : 'âŒ') + '\n';
                output += '4. MathJax.startup å­˜åœ¨: ' + (MathJax.startup ? 'âœ…' : 'âŒ') + '\n';

                if (MathJax.config) {
                    output += '5. MathJax é…ç½®:\n';
                    output += '   - inlineMath: ' + JSON.stringify(MathJax.config.tex?.inlineMath || 'N/A') + '\n';
                    output += '   - displayMath: ' + JSON.stringify(MathJax.config.tex?.displayMath || 'N/A') + '\n';
                }
            }

            output += '\n6. window.renderMathJax å­˜åœ¨: ' + (typeof window.renderMathJax === 'function' ? 'âœ…' : 'âŒ') + '\n';

            // æ£€æŸ¥é¡µé¢ä¸­çš„å…¬å¼å…ƒç´ 
            output += '\n7. é¡µé¢ç»Ÿè®¡:\n';
            const inlineFormulas = document.querySelectorAll('.MJX-TEX');
            const displayFormulas = document.querySelectorAll('.MJX-CHTML');
            output += '   - å†…è”å…¬å¼æ•°é‡: ' + inlineFormulas.length + '\n';
            output += '   - æ˜¾ç¤ºå…¬å¼æ•°é‡: ' + displayFormulas.length + '\n';

            // æ£€æŸ¥åŠ¨æ€å†…å®¹åŒºåŸŸ
            const dynamicArea = document.getElementById('dynamicContent');
            const dynamicFormulas = dynamicArea.textContent.match(/\$/g);
            output += '   - åŠ¨æ€åŒºåŸŸå…¬å¼æ ‡è®°($): ' + (dynamicFormulas ? dynamicFormulas.length : 0) + ' ä¸ª\n';

            // æµè§ˆå™¨ä¿¡æ¯
            output += '\n8. æµè§ˆå™¨ä¿¡æ¯:\n';
            output += '   - User Agent: ' + navigator.userAgent.substring(0, 80) + '...\n';
            output += '   - é¡µé¢ URL: ' + window.location.href + '\n';
            output += '   - åè®®: ' + window.location.protocol + '\n';

            diagnosticsDiv.textContent = output;
            console.log(output);
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œè¯Šæ–­
        window.addEventListener('load', () => {
            setTimeout(runDiagnostics, 2000);
        });
    </script>
</body>
</html>
